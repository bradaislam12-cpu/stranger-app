<body class="light-mode">

    <div class="header">
        <button class="icon-btn" onclick="location.href='dashboard.html'">๐</button>
        <h2 class="tr" data-key="profile">ุงูููู ุงูุดุฎุตู</h2>
        <button id="logoutBtn" class="icon-btn tr" data-key="logout" title="ุชุณุฌูู ุงูุฎุฑูุฌ">๐ช</button>
    </div>

    <div class="profile-card">
        <div class="settings-nav">
            <button id="themeBtn" class="icon-btn" style="font-size: 1.5rem;">๐</button>
            <button id="langBtn" class="friend-btn">EN</button>
        </div>

        <div class="avatar" id="uAvatar">?</div>
        <h3 id="uName">...</h3>
        <p id="uEmail" style="font-size: 0.85rem; opacity: 0.6; margin-bottom: 20px;"></p>

        <div class="data-box">
            <span class="tr" data-key="fullname">ุงูุงุณู ุงููุงูู</span>
            <input type="text" id="fullnameInput" class="tr" data-key="fullname" placeholder="ุฃุฏุฎู ุงุณูู">
        </div>

        <div class="data-box">
            <span class="tr" data-key="gender">ุงูุฌูุณ</span>
            <select id="userGender">
                <option value="male" class="tr" data-key="male">ุฐูุฑ</option>
                <option value="female" class="tr" data-key="female">ุฃูุซู</option>
            </select>
        </div>

        <div class="data-box">
            <span class="tr" data-key="seeking">ุฃูุชู ุจููุงุจูุฉ</span>
            <select id="seekingGender">
                <option value="male" class="tr" data-key="male">ุฑุฌุงู</option>
                <option value="female" class="tr" data-key="female">ูุณุงุก</option>
                <option value="both" class="tr" data-key="both">ุงูุฌููุน</option>
            </select>
        </div>

        <div class="data-box">
            <span class="tr" data-key="country">ุงุฎุชุฑ ุงูุฏููุฉ</span>
            <select id="userCountry">
                <option value="Algeria">ุงูุฌุฒุงุฆุฑ</option>
                <option value="Egypt">ูุตุฑ</option>
                <option value="Saudi Arabia">ุงูุณุนูุฏูุฉ</option>
                <option value="Morocco">ุงููุบุฑุจ</option>
                </select>
        </div>

        <div class="data-box">
            <span class="tr" data-key="interests">ุงูุงูุชูุงูุงุช ุงููุดุชุฑูุฉ</span>
            <div class="checkbox-group" id="interestsContainer">
                <label><input type="checkbox" name="interest" value="Sports"> <span class="tr" data-key="Sports">ุงูุฑูุงุถุฉ</span></label>
                <label><input type="checkbox" name="interest" value="Gaming"> <span class="tr" data-key="Gaming">ุงูุฃูุนุงุจ</span></label>
                <label><input type="checkbox" name="interest" value="Tech"> <span class="tr" data-key="Tech">ุงูุชูููุฉ</span></label>
                <label><input type="checkbox" name="interest" value="AI"> <span class="tr" data-key="AI">ุงูุฐูุงุก ุงูุงุตุทูุงุนู</span></label>
                </div>
        </div>

        <button class="save-btn tr" id="saveProfile" data-key="save_changes">ุญูุธ ุงูุจูุงูุงุช โ</button>
    </div>

    <script type="module">
        import { auth, db, toggleLang, toggleTheme, applyTranslations } from './ui-logic.js';
        import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ูุฒุงููุฉ ุงููุบุฉ ุนูุฏ ุงูุชุญููู
        const currentLang = localStorage.getItem('preferredLang') || 'ar';
        applyTranslations(currentLang);

        document.getElementById('themeBtn').onclick = toggleTheme;
        document.getElementById('langBtn').onclick = toggleLang;

        onAuthStateChanged(auth, async (user) => {
            if (!user) return location.href = "login.html";

            try {
                const docSnap = await getDoc(doc(db, "users", user.uid));
                if (docSnap.exists()) {
                    const u = docSnap.data();
                    document.getElementById("uName").innerText = u.fullname || "User";
                    document.getElementById("fullnameInput").value = u.fullname || "";
                    document.getElementById("uEmail").innerText = u.email;
                    document.getElementById("uAvatar").innerText = (u.fullname || "?").charAt(0).toUpperCase();
                    document.getElementById("userGender").value = u.gender || "male";
                    document.getElementById("seekingGender").value = u.seeking || "both";
                    document.getElementById("userCountry").value = u.country || "Algeria";

                    if (u.interests) {
                        const checkboxes = document.querySelectorAll('input[name="interest"]');
                        checkboxes.forEach(cb => cb.checked = u.interests.includes(cb.value));
                    }
                }
            } catch (err) { console.error("Error loading profile:", err); }
        });

        document.getElementById("saveProfile").onclick = async () => {
            const user = auth.currentUser;
            const btn = document.getElementById("saveProfile");
            const selectedInterests = Array.from(document.querySelectorAll('input[name="interest"]:checked')).map(cb => cb.value);

            try {
                btn.disabled = true;
                await updateDoc(doc(db, "users", user.uid), {
                    fullname: document.getElementById("fullnameInput").value,
                    gender: document.getElementById("userGender").value,
                    seeking: document.getElementById("seekingGender").value,
                    country: document.getElementById("userCountry").value,
                    interests: selectedInterests
                });

                // ุงุณุชุฎุฏุงู ุงููุงููุณ ููุฑุณุงุฆู
                const lang = localStorage.getItem('preferredLang') || 'ar';
                btn.innerText = lang === 'ar' ? "ุชู ุงูุญูุธ! โจ" : "Saved! โจ";
                
                setTimeout(() => { 
                    btn.disabled = false;
                    applyTranslations(lang); // ูุนูุฏ ุงููุต ุงูุฃุตูู ูู ุงููุงููุณ
                    document.getElementById("uAvatar").innerText = document.getElementById("fullnameInput").value.charAt(0).toUpperCase();
                    document.getElementById("uName").innerText = document.getElementById("fullnameInput").value;
                }, 2000);
            } catch (error) {
                btn.disabled = false;
                console.error(error);
            }
        };

        document.getElementById("logoutBtn").onclick = () => {
            signOut(auth).then(() => location.href="login.html");
        };
    </script>
</body>
