<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title class="tr" data-key="profile">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ | SM</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .profile-card { max-width: 450px; margin: 30px auto; background: var(--card); padding: 30px; border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); text-align: center; }
        .avatar { width: 90px; height: 90px; background: var(--p); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; margin: 0 auto 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .data-box { background: var(--bg); padding: 12px; border-radius: 12px; margin-bottom: 12px; text-align: right; border: 1px solid rgba(0,0,0,0.05); }
        .data-box span { display: block; font-size: 0.75rem; opacity: 0.6; font-weight: bold; margin-bottom: 4px; }
        select, input { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd; background: var(--card); color: var(--txt); margin-top: 5px; }
        .save-btn { width: 100%; background: var(--p); color: white; padding: 12px; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; margin-top: 15px; }
    </style>
</head>
<body class="light-mode">
    <div class="header">
        <button class="icon-btn" onclick="location.href='dashboard.html'">ğŸ”™</button>
        <h2 class="tr" data-key="profile">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h2>
        <button class="icon-btn" id="logoutBtn">ğŸšª</button>
    </div>

    <div class="profile-card">
        <div class="avatar" id="uAvatar">?</div>
        <h3 id="uName">...</h3>

        <div class="data-box">
            <span>Ø§Ù„Ø¬Ù†Ø³:</span>
            <select id="userGender">
                <option value="male">Ø°ÙƒØ±</option>
                <option value="female">Ø£Ù†Ø«Ù‰</option>
            </select>
        </div>

        <div class="data-box">
            <span>Ø£Ø¨Ø­Ø« Ø¹Ù†:</span>
            <select id="seekingGender">
                <option value="female">Ø¥Ù†Ø§Ø«</option>
                <option value="male">Ø°ÙƒÙˆØ±</option>
                <option value="both">Ø§Ù„ÙƒÙ„</option>
            </select>
        </div>

        <div class="data-box">
            <span>Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª:</span>
            <select id="userInterest">
                <option value="coding">Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©</option>
                <option value="music">Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰</option>
                <option value="travel">Ø§Ù„Ø³ÙØ±</option>
                <option value="gaming">Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨</option>
            </select>
        </div>

        <button class="save-btn" id="saveProfile">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
    </div>

    <script type="module">
        import { auth, db } from './ui-logic.js';
        import { doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        onAuthStateChanged(auth, async (user) => {
            if (!user) return location.href = "login.html";

            const docSnap = await getDoc(doc(db, "users", user.uid));
            if (docSnap.exists()) {
                const u = docSnap.data();
                document.getElementById("uName").innerText = u.fullname;
                document.getElementById("uAvatar").innerText = u.fullname.charAt(0).toUpperCase();
                document.getElementById("userGender").value = u.gender || "male";
                document.getElementById("seekingGender").value = u.seeking || "both";
                document.getElementById("userInterest").value = u.interest || "coding";
            }
        });

        document.getElementById("saveProfile").onclick = async () => {
            const user = auth.currentUser;
            const btn = document.getElementById("saveProfile");
            btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...";
            
            await updateDoc(doc(db, "users", user.uid), {
                gender: document.getElementById("userGender").value,
                seeking: document.getElementById("seekingGender").value,
                interest: document.getElementById("userInterest").value
            });
            
            btn.innerText = "ØªÙ… Ø§Ù„Ø­ÙØ¸ âœ…";
            setTimeout(() => btn.innerText = "Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª", 2000);
        };

        document.getElementById("logoutBtn").onclick = () => signOut(auth).then(() => location.href="login.html");
    </script>
</body>
</html>
