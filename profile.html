here<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ | SM</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .profile-card { text-align: center; position: relative; background: var(--card); padding: 25px; border-radius: 20px; box-shadow: var(--shadow); }
    .avatar-wrapper { position: relative; width: 120px; height: 120px; margin: 0 auto 20px; }
    .avatar-wrapper img { 
      width: 100%; height: 100%; border-radius: 50%; 
      object-fit: cover; border: 4px solid var(--p); background: #eee;
    }
    .edit-icon {
      position: absolute; bottom: 5px; right: 5px; background: var(--p);
      color: white; border-radius: 50%; width: 32px; height: 32px; 
      display: flex; align-items: center; justify-content: center; cursor: pointer; border: 2px solid white;
    }
    .interests-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
      gap: 12px; text-align: right; margin: 15px 0; background: rgba(0,0,0,0.02); padding: 15px; border-radius: 12px;
    }
    .interest-item { display: flex; align-items: center; gap: 8px; font-size: 0.9rem; color: var(--text); }
    .interest-item input { width: 18px; height: 18px; margin: 0; cursor: pointer; }
    .danger-zone { margin-top: 30px; padding-top: 20px; border-top: 1px dashed #ddd; }
    .profile-form { max-width: 500px; margin: 20px auto; padding: 0 15px; }
    label { display: block; margin-top: 15px; font-weight: bold; font-size: 0.85rem; color: var(--p); }
    select, input[type="text"] { width: 100%; padding: 12px; border-radius: 10px; border: 1px solid #ddd; margin-top: 5px; }
  </style>
</head>
<body class="light-mode">

  <div class="header">
    <button class="icon-btn" onclick="location.href='dashboard.html'">ğŸ”™</button>
    <h2 class="tr" data-key="profile_header">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h2>
    <div style="display:flex; gap:8px;">
      <button id="themeBtn" class="icon-btn">ğŸŒ“</button>
      <button id="langBtn" class="friend-btn">EN</button>
    </div>
  </div>

  <div class="profile-form">
    <div class="profile-card">
      <div class="avatar-wrapper">
        <img id="profilePreview" src="default-avatar.png">
        <label for="avatarInput" class="edit-icon">ğŸ“·</label>
        <input type="file" id="avatarInput" hidden accept="image/*">
      </div>
      
      <form id="profileUpdateForm">
        <label class="tr" data-key="fullname_placeholder">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
        <input type="text" id="pFullname" required placeholder="Ø§Ø³Ù…Ø¬ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„">

        <label class="tr" data-key="gender_label">Ø§Ù„Ø¬Ù†Ø³</label>
        <select id="pGender">
          <option value="male">Ø°ÙƒØ±</option>
          <option value="female">Ø£Ù†Ø«Ù‰</option>
        </select>

        <label class="tr" data-key="seeking_label">Ø£Ù‡ØªÙ… Ø¨Ù…Ù‚Ø§Ø¨Ù„Ø©</label>
        <select id="pSeeking">
          <option value="male">Ø±Ø¬Ø§Ù„</option>
          <option value="female">Ù†Ø³Ø§Ø¡</option>
          <option value="both">Ø§Ù„Ø¬Ù…ÙŠØ¹</option>
        </select>

        <label class="tr" data-key="interests_label">Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª (Ø§Ø®ØªØ± Ù…Ø§ ØªØ­Ø¨)</label>
        <div class="interests-grid" id="pInterests"></div>

        <button type="submit" id="saveBtn" class="start-btn tr" data-key="save_changes" style="width: 100%; border: none; margin-top: 20px;">
          Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª âœ…
        </button>
      </form>

      <div class="danger-zone">
        <button id="deleteAccBtn" class="icon-btn" style="color:var(--danger); font-size: 0.9rem; cursor: pointer;">
          âš ï¸ <span class="tr" data-key="delete_account">Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹</span>
        </button>
      </div>
    </div>
    <div id="pStatus" style="margin-top:15px; text-align:center; font-weight:bold; min-height: 1.5rem;"></div>
  </div>

  <script type="module">
    import { auth, db, toggleLang, toggleTheme, initUI } from './ui-logic.js';
    import { doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { deleteAccount } from './ui-logic.js';

    const interestsList = ["Sports", "Gaming", "Tech", "Music", "Art", "Travel", "Cooking", "Coding", "Movies", "Reading"];
    
    // 1. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    initUI();
    document.getElementById('themeBtn').onclick = toggleTheme;
    document.getElementById('langBtn').onclick = toggleLang;

    // 2. Ø¨Ù†Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª
    const grid = document.getElementById('pInterests');
    interestsList.forEach(item => {
      const div = document.createElement('div');
      div.className = 'interest-item';
      div.innerHTML = `<input type="checkbox" value="${item}"> <span>${item}</span>`;
      grid.appendChild(div);
    });

    // 3. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø§Ø³ØªÙ‚Ø±Ø§Ø± Ø­Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    auth.onAuthStateChanged(async (user) => {
      if (!user) {
        window.location.replace("login.html");
        return;
      }

      const userRef = doc(db, "users", user.uid);
      const snap = await getDoc(userRef);
      
      if (snap.exists()) {
        const data = snap.data();
        document.getElementById('pFullname').value = data.fullname || "";
        document.getElementById('pGender').value = data.gender || "male";
        document.getElementById('pSeeking').value = data.seeking || "both";
        document.getElementById('profilePreview').src = data.avatarUrl || "default-avatar.png";
        
        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©
        const checks = document.querySelectorAll('#pInterests input');
        checks.forEach(ch => {
          if (data.interests && Array.isArray(data.interests) && data.interests.includes(ch.value)) {
            ch.checked = true;
          }
        });
      }
    });

    // 4. Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø«Ø©
    document.getElementById('profileUpdateForm').onsubmit = async (e) => {
      e.preventDefault();
      const btn = document.getElementById('saveBtn');
      const status = document.getElementById('pStatus');
      const selectedInterests = Array.from(document.querySelectorAll('#pInterests input:checked')).map(c => c.value);

      try {
        btn.disabled = true;
        status.innerText = "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...";
        
        await updateDoc(doc(db, "users", auth.currentUser.uid), {
          fullname: document.getElementById('pFullname').value.trim(),
          gender: document.getElementById('pGender').value,
          seeking: document.getElementById('pSeeking').value,
          interests: selectedInterests
        });

        status.style.color = "#28a745";
        status.innerText = "ØªÙ… ØªØ­Ø¯ÙŠØ« Ù…Ù„ÙÙƒ Ø¨Ù†Ø¬Ø§Ø­! âœ¨";
        setTimeout(() => { status.innerText = ""; btn.disabled = false; }, 3000);
      } catch (err) {
        console.error(err);
        status.style.color = "var(--danger)";
        status.innerText = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸ØŒ Ø­Ø§ÙˆÙ„ Ø«Ø§Ù†ÙŠØ©";
        btn.disabled = false;
      }
    };

    // 5. Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨
    document.getElementById('deleteAccBtn').onclick = async () => {
      if (confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ø­Ø³Ø§Ø¨ÙƒØŸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡!")) {
        await deleteAccount();
      }
    };

    // 6. Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø© Ù…Ø­Ù„ÙŠØ§Ù‹
    document.getElementById('avatarInput').onchange = (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (event) => {
          document.getElementById('profilePreview').src = event.target.result;
        };
        reader.readAsDataURL(file);
        // Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ø±ÙØ¹ Ø§Ù„ÙØ¹Ù„ÙŠ Ù„Ù€ Firebase Storage ÙŠØªØ·Ù„Ø¨ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©ØŒ Ø­Ø§Ù„ÙŠØ§Ù‹ Ø§Ù„ØªØºÙŠÙŠØ± Ù…Ø­Ù„ÙŠ.
      }
    };
  </script>
</body>
</html>
