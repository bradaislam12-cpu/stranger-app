<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title class="tr" data-key="profile">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ | SM</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .profile-card { max-width: 450px; margin: 30px auto; background: var(--card); padding: 30px; border-radius: 20px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); text-align: center; }
        .avatar { width: 90px; height: 90px; background: var(--p); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; margin: 0 auto 20px; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
        .data-box { background: var(--bg); padding: 12px; border-radius: 12px; margin-bottom: 12px; text-align: right; border: 1px solid rgba(0,0,0,0.05); }
        .data-box span { display: block; font-size: 0.75rem; opacity: 0.6; font-weight: bold; margin-bottom: 5px; }
        input, select { width: 100%; border: none; background: transparent; font-size: 1rem; color: var(--txt); outline: none; }
        .save-btn { width: 100%; padding: 15px; background: var(--p); color: white; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; margin-top: 10px; transition: 0.3s; }
        .save-btn:hover { opacity: 0.9; transform: translateY(-2px); }
    </style>
</head>
<body class="light-mode">

    <div class="header">
        <button class="icon-btn" onclick="location.href='dashboard.html'">ğŸ”™</button>
        <h2 class="tr" data-key="profile">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h2>
        <button id="logoutBtn" class="icon-btn">ğŸšª</button>
    </div>

    <div class="profile-card">
        <div class="avatar" id="uAvatar">?</div>
        <h3 id="uName">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h3>
        <p id="uEmail" style="font-size: 0.85rem; opacity: 0.6; margin-bottom: 25px;"></p>

        <div class="data-box">
            <span>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</span>
            <input type="text" id="fullnameInput">
        </div>

        <div class="data-box">
            <span>Ø¬Ù†Ø³ÙŠ</span>
            <select id="userGender">
                <option value="male">Ø°ÙƒØ±</option>
                <option value="female">Ø£Ù†Ø«Ù‰</option>
            </select>
        </div>

        <div class="data-box">
            <span>Ø£Ø¨Ø­Ø« Ø¹Ù† (ÙÙŠ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø¹Ø´ÙˆØ§Ø¦ÙŠ)</span>
            <select id="seekingGender">
                <option value="male">Ø±Ø¬Ø§Ù„ ÙÙ‚Ø·</option>
                <option value="female">Ù†Ø³Ø§Ø¡ ÙÙ‚Ø·</option>
                <option value="both">Ø§Ù„Ø¬Ù…ÙŠØ¹ (Ø¹Ø´ÙˆØ§Ø¦ÙŠ)</option>
                <option value="same">Ù†ÙØ³ Ø¬Ù†Ø³ÙŠ</option>
            </select>
        </div>

        <div class="data-box">
            <span>Ø§Ù„Ø¨Ù„Ø¯</span>
            <input type="text" id="userCountry" placeholder="Ù…Ø«Ø§Ù„: Ù…ØµØ±ØŒ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±...">
        </div>

        <div class="data-box">
            <span>Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª</span>
            <input type="text" id="userInterest" placeholder="Ù…Ø«Ø§Ù„: Ø±ÙŠØ§Ø¶Ø©ØŒ Ø³ÙØ±ØŒ ØªÙ‚Ù†ÙŠØ©">
        </div>

        <button class="save-btn" id="saveProfile">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª âœ…</button>
    </div>

    <script type="module">
        import { auth, db } from './ui-logic.js';
        import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        onAuthStateChanged(auth, async (user) => {
            if (!user) return location.href = "login.html";

            const docSnap = await getDoc(doc(db, "users", user.uid));
            if (docSnap.exists()) {
                const u = docSnap.data();
                document.getElementById("uName").innerText = u.fullname;
                document.getElementById("fullnameInput").value = u.fullname;
                document.getElementById("uEmail").innerText = u.email;
                document.getElementById("uAvatar").innerText = u.fullname.charAt(0).toUpperCase();
                
                // ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                document.getElementById("userGender").value = u.gender || "male";
                document.getElementById("seekingGender").value = u.seeking || "both";
                document.getElementById("userCountry").value = u.country || "";
                document.getElementById("userInterest").value = u.interest || "";
            }
        });

        // Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
        document.getElementById("saveProfile").onclick = async () => {
            const user = auth.currentUser;
            const btn = document.getElementById("saveProfile");
            
            try {
                btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø­ÙØ¸...";
                btn.disabled = true;

                await updateDoc(doc(db, "users", user.uid), {
                    fullname: document.getElementById("fullnameInput").value,
                    gender: document.getElementById("userGender").value,
                    seeking: document.getElementById("seekingGender").value,
                    country: document.getElementById("userCountry").value,
                    interest: document.getElementById("userInterest").value
                });

                btn.innerText = "ØªÙ… Ø§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­! âœ¨";
                setTimeout(() => {
                    btn.innerText = "Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª âœ…";
                    btn.disabled = false;
                }, 2000);
            } catch (error) {
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸");
                btn.disabled = false;
            }
        };

        document.getElementById("logoutBtn").onclick = () => signOut(auth).then(() => location.href="login.html");
    </script>
</body>
</html>
