<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title class="tr" data-key="profile">ุงูููู ุงูุดุฎุตู | SM</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .profile-card { max-width: 450px; margin: 20px auto; background: var(--card); padding: 25px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); text-align: center; }
        .avatar { width: 100px; height: 100px; background: var(--p); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3rem; margin: 0 auto 15px; box-shadow: 0 4px 15px rgba(7, 94, 84, 0.3); border: 4px solid var(--card); }
        .data-box { background: var(--bg); padding: 12px; border-radius: 15px; margin-bottom: 12px; text-align: right; border: 1px solid rgba(0,0,0,0.05); transition: 0.3s; }
        .data-box:focus-within { border-color: var(--p); transform: scale(1.02); }
        .data-box span { display: block; font-size: 0.75rem; opacity: 0.7; font-weight: bold; margin-bottom: 5px; color: var(--p); }
        input[type="text"], select { width: 100%; border: none; background: transparent; font-size: 1rem; color: var(--txt); outline: none; cursor: pointer; }
        
        .checkbox-group { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            text-align: right; 
            gap: 12px; 
            max-height: 150px; 
            overflow-y: auto; 
            padding: 10px;
            background: rgba(0,0,0,0.03);
            border-radius: 10px;
        }
        .checkbox-group label { font-size: 0.9rem; cursor: pointer; display: flex; align-items: center; gap: 8px; color: var(--txt); }

        .save-btn { width: 100%; padding: 16px; background: var(--p); color: white; border: none; border-radius: 15px; font-weight: bold; cursor: pointer; margin-top: 15px; transition: 0.4s; font-size: 1rem; }
        .save-btn:hover { filter: brightness(1.1); transform: translateY(-3px); box-shadow: 0 5px 15px rgba(7, 94, 84, 0.4); }
        .save-btn:disabled { background: #ccc; cursor: not-allowed; }
        
        .settings-nav { display: flex; gap: 20px; justify-content: center; margin-bottom: 20px; }
    </style>
</head>
<body class="light-mode">

    <div class="header">
        <button class="icon-btn" onclick="location.href='dashboard.html'">๐</button>
        <h2 class="tr" data-key="profile">ุงูููู ุงูุดุฎุตู</h2>
        <button id="logoutBtn" class="icon-btn" title="ุชุณุฌูู ุงูุฎุฑูุฌ">๐ช</button>
    </div>

    <div class="profile-card">
        <div class="settings-nav">
            <button id="themeBtn" class="icon-btn" style="font-size: 1.5rem;">๐</button>
            <button id="langBtn" class="friend-btn">EN</button>
        </div>

        <div class="avatar" id="uAvatar">?</div>
        <h3 id="uName">...</h3>
        <p id="uEmail" style="font-size: 0.85rem; opacity: 0.6; margin-bottom: 20px;"></p>

        <div class="data-box">
            <span class="tr" data-key="fullname">ุงูุงุณู ุงููุงูู</span>
            <input type="text" id="fullnameInput" placeholder="ุฃุฏุฎู ุงุณูู">
        </div>

        <div class="data-box">
            <span class="tr" data-key="gender">ุงูุฌูุณ</span>
            <select id="userGender">
                <option value="male">ุฐูุฑ</option>
                <option value="female">ุฃูุซู</option>
            </select>
        </div>

        <div class="data-box">
            <span class="tr" data-key="seeking">ุฃูุชู ุจููุงุจูุฉ</span>
            <select id="seekingGender">
                <option value="male">ุฑุฌุงู</option>
                <option value="female">ูุณุงุก</option>
                <option value="both">ุงูุฌููุน</option>
            </select>
        </div>

        <div class="data-box">
    <span>ุงุฎุชุฑ ุงูุฏููุฉ</span>
    <select id="userCountry">
        <option value="Afghanistan">ุฃูุบุงูุณุชุงู</option>
        <option value="Albania">ุฃูุจุงููุง</option>
        <option value="Algeria">ุงูุฌุฒุงุฆุฑ</option>
        <option value="Andorra">ุฃูุฏูุฑุง</option>
        <option value="Angola">ุฃูุบููุง</option>
        <option value="Argentina">ุงูุฃุฑุฌูุชูู</option>
        <option value="Armenia">ุฃุฑููููุง</option>
        <option value="Australia">ุฃุณุชุฑุงููุง</option>
        <option value="Austria">ุงูููุณุง</option>
        <option value="Bahrain">ุงูุจุญุฑูู</option>
        <option value="Bangladesh">ุจูุบูุงุฏูุด</option>
        <option value="Belgium">ุจูุฌููุง</option>
        <option value="Brazil">ุงูุจุฑุงุฒูู</option>
        <option value="Canada">ููุฏุง</option>
        <option value="China">ุงูุตูู</option>
        <option value="Colombia">ูููููุจูุง</option>
        <option value="Denmark">ุงูุฏููุงุฑู</option>
        <option value="Egypt">ูุตุฑ</option>
        <option value="France">ูุฑูุณุง</option>
        <option value="Germany">ุฃููุงููุง</option>
        <option value="India">ุงูููุฏ</option>
        <option value="Indonesia">ุฅูุฏูููุณูุง</option>
        <option value="Iran">ุฅูุฑุงู</option>
        <option value="Iraq">ุงูุนุฑุงู</option>
        <option value="Italy">ุฅูุทุงููุง</option>
        <option value="Japan">ุงููุงุจุงู</option>
        <option value="Jordan">ุงูุฃุฑุฏู</option>
        <option value="Kuwait">ุงููููุช</option>
        <option value="Lebanon">ูุจูุงู</option>
        <option value="Libya">ููุจูุง</option>
        <option value="Malaysia">ูุงููุฒูุง</option>
        <option value="Mexico">ุงูููุณูู</option>
        <option value="Morocco">ุงููุบุฑุจ</option>
        <option value="Netherlands">ููููุฏุง</option>
        <option value="New Zealand">ูููุฒูููุฏุง</option>
        <option value="Nigeria">ููุฌูุฑูุง</option>
        <option value="Norway">ุงููุฑููุฌ</option>
        <option value="Oman">ุนููุงู</option>
        <option value="Pakistan">ุจุงูุณุชุงู</option>
        <option value="Palestine">ููุณุทูู</option>
        <option value="Philippines">ุงูููุจูู</option>
        <option value="Poland">ุจูููุฏุง</option>
        <option value="Portugal">ุงูุจุฑุชุบุงู</option>
        <option value="Qatar">ูุทุฑ</option>
        <option value="Russia">ุฑูุณูุง</option>
        <option value="Saudi Arabia">ุงูุณุนูุฏูุฉ</option>
        <option value="South Africa">ุฌููุจ ุฃูุฑูููุง</option>
        <option value="South Korea">ููุฑูุง ุงูุฌููุจูุฉ</option>
        <option value="Spain">ุฅุณุจุงููุง</option>
        <option value="Sudan">ุงูุณูุฏุงู</option>
        <option value="Sweden">ุงูุณููุฏ</option>
        <option value="Switzerland">ุณููุณุฑุง</option>
        <option value="Syria">ุณูุฑูุง</option>
        <option value="Tunisia">ุชููุณ</option>
        <option value="Turkey">ุชุฑููุง</option>
        <option value="UAE">ุงูุฅูุงุฑุงุช</option>
        <option value="UK">ุงูููููุฉ ุงููุชุญุฏุฉ</option>
        <option value="USA">ุงูููุงูุงุช ุงููุชุญุฏุฉ</option>
        <option value="Yemen">ุงูููู</option>
        <option value="Others">ุฏูู ุฃุฎุฑู</option>
    </select>
</div>


       <div class="data-box">
    <span class="tr" data-key="interests">ุงูุงูุชูุงูุงุช ุงููุดุชุฑูุฉ</span>
    <div class="checkbox-group" id="interestsContainer">
        <label><input type="checkbox" name="interest" value="Sports"> ุงูุฑูุงุถุฉ</label><br>
        <label><input type="checkbox" name="interest" value="Gaming"> ุงูุฃูุนุงุจ</label><br>
        <label><input type="checkbox" name="interest" value="Music"> ุงูููุณููู</label><br>
        <label><input type="checkbox" name="interest" value="Movies"> ุงูุฃููุงู ูุงููุณูุณูุงุช</label><br>
        <label><input type="checkbox" name="interest" value="Books"> ุงููุชุจ ูุงููุฑุงุกุฉ</label><br>
        <label><input type="checkbox" name="interest" value="Tech"> ุงูุชูููุฉ</label><br>
        <label><input type="checkbox" name="interest" value="AI"> ุงูุฐูุงุก ุงูุงุตุทูุงุนู</label><br>
        <label><input type="checkbox" name="interest" value="Programming"> ุงูุจุฑูุฌุฉ</label><br>
        <label><input type="checkbox" name="interest" value="Travel"> ุงูุณูุฑ</label><br>
        <label><input type="checkbox" name="interest" value="Cooking"> ุงูุทุจุฎ</label><br>
        <label><input type="checkbox" name="interest" value="Fashion"> ุงูููุถุฉ ูุงูุฃุฒูุงุก</label><br>
        <label><input type="checkbox" name="interest" value="Pets"> ุงูุญููุงูุงุช ุงูุฃูููุฉ</label><br>
        <label><input type="checkbox" name="interest" value="Photography"> ุงูุชุตููุฑ</label><br>
        <label><input type="checkbox" name="interest" value="Art"> ุงููููู ูุงูุฑุณู</label><br>
        <label><input type="checkbox" name="interest" value="Volunteering"> ุงูุนูู ุงูุชุทูุนู</label><br>
        <label><input type="checkbox" name="interest" value="Fitness"> ุงูุตุญุฉ ูุงูููุงูุฉ</label><br>
        <label><input type="checkbox" name="interest" value="Chat"> ุฏุฑุฏุดุฉ ุนุงูุฉ</label><br>
        <label><input type="checkbox" name="interest" value="Business"> ุงูุฃุนูุงู ูุงูุชุฌุงุฑุฉ</label><br>
        <label><input type="checkbox" name="interest" value="Science"> ุงูุนููู</label><br>
        <label><input type="checkbox" name="interest" value="History"> ุงูุชุงุฑูุฎ</label><br>
        <label><input type="checkbox" name="interest" value="Languages"> ุชุนูู ุงููุบุงุช</label><br>
        <label><input type="checkbox" name="interest" value="Nature"> ุงูุทุจูุนุฉ ูุงูุฑุญูุงุช</label><br>
        <label><input type="checkbox" name="interest" value="Food"> ุงููุฃูููุงุช</label><br>
        <label><input type="checkbox" name="interest" value="Others"> ุงูุชูุงูุงุช ุฃุฎุฑู</label>
    </div>
</div>


        <button class="save-btn tr" id="saveProfile" data-key="save">ุญูุธ ุงูุจูุงูุงุช โ</button>
    </div>

    <script type="module">
        import { auth, db, toggleLang, toggleTheme } from './ui-logic.js';
        import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ุฑุจุท ุงูุฃุฒุฑุงุฑ
        document.getElementById('themeBtn').onclick = toggleTheme;
        document.getElementById('langBtn').onclick = toggleLang;

        onAuthStateChanged(auth, async (user) => {
            if (!user) return location.href = "login.html";

            try {
                const docSnap = await getDoc(doc(db, "users", user.uid));
                if (docSnap.exists()) {
                    const u = docSnap.data();
                    document.getElementById("uName").innerText = u.fullname || "ูุณุชุฎุฏู ุฌุฏูุฏ";
                    document.getElementById("fullnameInput").value = u.fullname || "";
                    document.getElementById("uEmail").innerText = u.email;
                    document.getElementById("uAvatar").innerText = (u.fullname || "?").charAt(0).toUpperCase();
                    
                    document.getElementById("userGender").value = u.gender || "male";
                    document.getElementById("seekingGender").value = u.seeking || "both";
                    document.getElementById("userCountry").value = u.country || "Egypt";

                    if (u.interests) {
                        const checkboxes = document.querySelectorAll('input[name="interest"]');
                        checkboxes.forEach(cb => cb.checked = u.interests.includes(cb.value));
                    }
                }
            } catch (err) { console.error("Error loading profile:", err); }
        });

        document.getElementById("saveProfile").onclick = async () => {
            const user = auth.currentUser;
            const btn = document.getElementById("saveProfile");
            const selectedInterests = Array.from(document.querySelectorAll('input[name="interest"]:checked')).map(cb => cb.value);

            try {
                btn.innerText = "ุฌุงุฑู ุงูุญูุธ...";
                btn.disabled = true;

                await updateDoc(doc(db, "users", user.uid), {
                    fullname: document.getElementById("fullnameInput").value,
                    gender: document.getElementById("userGender").value,
                    seeking: document.getElementById("seekingGender").value,
                    country: document.getElementById("userCountry").value,
                    interests: selectedInterests
                });

                btn.innerText = "ุชู ุงูุญูุธ ุจูุฌุงุญ! โจ";
                setTimeout(() => { 
                    btn.innerText = "ุญูุธ ุงูุจูุงูุงุช โ"; 
                    btn.disabled = false; 
                    // ุชุญุฏูุซ ุงูุฃูุงุชุงุฑ ูุงูุงุณู ููุฑุงู ูู ุงูุตูุญุฉ
                    document.getElementById("uAvatar").innerText = document.getElementById("fullnameInput").value.charAt(0).toUpperCase();
                    document.getElementById("uName").innerText = document.getElementById("fullnameInput").value;
                }, 1500);
            } catch (error) {
                alert("ุนุฐุฑุงูุ ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุญูุธ.");
                btn.disabled = false;
            }
        };

        document.getElementById("logoutBtn").onclick = () => {
            if(confirm("ูู ุฃูุช ูุชุฃูุฏ ูู ุชุณุฌูู ุงูุฎุฑูุฌุ")) {
                signOut(auth).then(() => location.href="login.html");
            }
        };
    </script>
</body>
</html>

