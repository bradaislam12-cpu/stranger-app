<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title class="tr" data-key="profile">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ | SM</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .profile-container { max-width: 500px; margin: 30px auto; padding: 20px; }
        .info-card { background: var(--card); padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .avatar-circle { width: 80px; height: 80px; background: var(--p); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 2rem; margin: 0 auto 20px; }
        .data-row { margin-bottom: 15px; text-align: right; }
        .data-row label { display: block; font-weight: bold; margin-bottom: 5px; opacity: 0.8; font-size: 0.9rem; }
        .data-value { background: var(--bg); padding: 10px; border-radius: 8px; border: 1px solid rgba(0,0,0,0.05); }
        .action-btns { display: flex; flex-direction: column; gap: 10px; margin-top: 25px; }
    </style>
</head>
<body class="light-mode">

    <div class="header">
        <button class="icon-btn" onclick="location.href='dashboard.html'">ğŸ”™</button>
        <span class="tr" data-key="profile">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</span>
        <button onclick="toggleTheme()" class="icon-btn">ğŸŒ“</button>
    </div>

    <div class="profile-container">
        <div class="info-card">
            <div id="uAvatar" class="avatar-circle">?</div>
            
            <div class="data-row">
                <label class="tr" data-key="fullname">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                <div id="dispName" class="data-value">...</div>
            </div>

            <div class="data-row">
                <label class="tr" data-key="age">Ø§Ù„Ø¹Ù…Ø±</label>
                <div id="dispAge" class="data-value">...</div>
            </div>

            <div class="data-row">
                <label class="tr" data-key="country">Ø§Ù„Ø¨Ù„Ø¯</label>
                <div id="dispCountry" class="data-value">...</div>
            </div>

            <div class="data-row">
                <label class="tr" data-key="interests">Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª</label>
                <div id="dispInterest" class="data-value">...</div>
            </div>

            <div class="action-btns">
                <button onclick="toggleLang()" style="background: #555;">ğŸŒ Change Language / ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ©</button>
                <button id="logoutBtn" style="background: #ff4d4d;" class="tr" data-key="logout">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
            </div>
        </div>
    </div>

    <script src="ui-logic.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyAMA4owgSvA_sBh2syHOnRTS5fhnW1JIeg", 
            authDomain: "strangermeeting-91226.firebaseapp.com", 
            projectId: "strangermeeting-91226", 
            storageBucket: "strangermeeting-91226.firebasestorage.app", 
            messagingSenderId: "575547116212", 
            appId: "1:575547116212:web:333a4732abf59903e7e5e1" 
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        onAuthStateChanged(auth, async (user) => {
            if (!user) return location.href = "login.html";

            // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…Ù† Firestore
            const docRef = doc(db, "users", user.uid);
            const docSnap = await getDoc(docRef);

            if (docSnap.exists()) {
                const data = docSnap.data();
                const lang = localStorage.getItem('sm-lang') || 'ar';

                // Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø®Ø§Ù†Ø§Øª
                document.getElementById("dispName").innerText = data.fullname || "---";
                document.getElementById("dispAge").innerText = data.age || "---";
                
                // ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø¨Ù„Ø¯ ÙˆØ§Ù„Ø§Ù‡ØªÙ…Ø§Ù… Ù…Ù† Ø§Ù„Ù‚Ø§Ù…ÙˆØ³ Ù‚Ø¨Ù„ Ø§Ù„Ø¹Ø±Ø¶
                document.getElementById("dispCountry").innerText = i18n[lang][data.country] || data.country;
                document.getElementById("dispInterest").innerText = i18n[lang][data.interest] || data.interest;
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£ÙØ§ØªØ§Ø±
                document.getElementById("uAvatar").innerText = data.fullname.charAt(0).toUpperCase();
            }
        });

        document.getElementById("logoutBtn").onclick = () => {
            if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ")) signOut(auth).then(() => location.href = "index.html");
        };
    </script>
</body>
</html>
