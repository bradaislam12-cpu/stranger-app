<!DOCTYPE html>
<html lang="ar" dir="rtl" id="mainHtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ ğŸ‘¤ | Stranger Meeting</title>
    <style>
        :root { --bg: #f0f2f5; --card: #fff; --text: #333; --accent: #4CAF50; --input: #fff; }
        [data-theme="dark"] { --bg: #121212; --card: #1e1e1e; --text: #eee; --accent: #00a884; --input: #2a2a2a; }

        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); display: flex; justify-content: center; padding: 20px; transition: 0.3s; }
        .profile-card { background: var(--card); padding: 30px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 100%; max-width: 500px; position: relative; }
        .back-btn { position: absolute; top: 20px; left: 20px; text-decoration: none; font-size: 22px; }
        
        h2 { color: var(--accent); text-align: center; margin-bottom: 20px; }
        label { display: block; margin-top: 15px; font-weight: bold; font-size: 14px; color: var(--accent); }
        input, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 10px; background: var(--input); color: var(--text); }
        
        .interests-container { 
            height: 200px; overflow-y: auto; border: 1px solid #ddd; border-radius: 10px; 
            padding: 10px; background: var(--input); margin-top: 5px;
        }
        .int-group-title { font-weight: bold; font-size: 12px; color: #888; margin-top: 10px; border-bottom: 1px solid #eee; }
        .int-item { display: flex; align-items: center; gap: 8px; padding: 5px 0; font-size: 14px; }
        .int-item input { width: auto; margin: 0; }

        .save-btn { width: 100%; padding: 14px; background: var(--accent); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 16px; margin-top: 25px; }
        .points-badge { text-align: center; background: #FFD700; color: #000; padding: 5px; border-radius: 10px; font-weight: bold; margin-bottom: 20px; }
    </style>
</head>
<body>

<div class="profile-card">
    <a href="dashboard.html" class="back-btn">â¬…ï¸</a>
    <h2>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ ğŸ‘¤</h2>
    
    <div class="points-badge">Ø±ØµÙŠØ¯Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ: ğŸ’° <span id="uPoints">0</span> Ù†Ù‚Ø·Ø©</div>

    <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ ğŸ“›</label>
    <input type="text" id="uName" placeholder="Ø§Ø³Ù…Ùƒ">

    <label>Ø§Ù„Ø¯ÙˆÙ„Ø© ÙˆØ§Ù„Ù…Ù†Ø·Ù‚Ø© ğŸŒ Country</label>
    <select id="uCountry">
        <option value="">Ø§Ø®ØªØ± Ø¯ÙˆÙ„ØªÙƒ...</option>
        <optgroup label="ğŸŒ Ø¥ÙØ±ÙŠÙ‚ÙŠØ§ (Africa)">
            <option value="Algeria">Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± | Algeria</option>
            <option value="Egypt">Ù…ØµØ± | Egypt</option>
            <option value="Morocco">Ø§Ù„Ù…ØºØ±Ø¨ | Morocco</option>
            <option value="Tunisia">ØªÙˆÙ†Ø³ | Tunisia</option>
            <option value="Libya">Ù„ÙŠØ¨ÙŠØ§ | Libya</option>
            <option value="Nigeria">Ù†ÙŠØ¬ÙŠØ±ÙŠØ§ | Nigeria</option>
            <option value="South Africa">South Africa</option>
        </optgroup>
        <optgroup label="ğŸŒ Ø¢Ø³ÙŠØ§ (Asia)">
            <option value="Saudi Arabia">Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ© | Saudi Arabia</option>
            <option value="UAE">Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª | UAE</option>
            <option value="Qatar">Ù‚Ø·Ø± | Qatar</option>
            <option value="Iraq">Ø§Ù„Ø¹Ø±Ø§Ù‚ | Iraq</option>
            <option value="Turkey">ØªØ±ÙƒÙŠØ§ | Turkey</option>
            <option value="Japan">Ø§Ù„ÙŠØ§Ø¨Ø§Ù† | Japan</option>
        </optgroup>
        <optgroup label="ğŸŒ Ø£ÙˆØ±ÙˆØ¨Ø§ (Europe)">
            <option value="France">ÙØ±Ù†Ø³Ø§ | France</option>
            <option value="Germany">Ø£Ù„Ù…Ø§Ù†ÙŠØ§ | Germany</option>
            <option value="UK">Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ù…ØªØ­Ø¯Ø© | UK</option>
        </optgroup>
        <optgroup label="ğŸŒ Ø£Ù…Ø±ÙŠÙƒØ§">
            <option value="USA">Ø£Ù…Ø±ÙŠÙƒØ§ | USA</option>
            <option value="Canada">ÙƒÙ†Ø¯Ø§ | Canada</option>
            <option value="Brazil">Ø§Ù„Ø¨Ø±Ø§Ø²ÙŠÙ„ | Brazil</option>
        </optgroup>
    </select>

    <label>Ø§Ù‡ØªÙ…Ø§Ù…Ø§ØªÙƒ Ø§Ù„Ù…ÙØ¶Ù„Ø© ğŸ¨ Interests</label>
    <div class="interests-container" id="interestsList">
        </div>

    <button class="save-btn" onclick="saveProfile()">Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª âœ…</button>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const firebaseConfig = { 
        apiKey: "AIzaSyAMA4owgSvA_sBh2syHOnRTS5fhnW1JIeg", 
        authDomain: "strangermeeting-91226.firebaseapp.com", 
        projectId: "strangermeeting-91226", 
        storageBucket: "strangermeeting-91226.firebasestorage.app", 
        messagingSenderId: "575547116212", 
        appId: "1:575547116212:web:333a4732abf59903e7e5e1" 
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const interestsData = [
        { cat: "ğŸ§‘â€ğŸ“ Ø§Ù„ØªØ¹Ù„ÙŠÙ… ÙˆØ§Ù„Ù…Ø¹Ø±ÙØ©", items: ["Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© ÙˆØ§Ù„ÙƒØªØ¨", "ØªØ¹Ù„Ù… Ø§Ù„Ù„ØºØ§Øª", "Ø§Ù„Ø¯ÙˆØ±Ø§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©", "Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„Ø«Ù‚Ø§ÙØ©", "Ø§Ù„Ø¹Ù„ÙˆÙ… ÙˆØ§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§"] },
        { cat: "ğŸ¨ Ø§Ù„ÙÙ†ÙˆÙ† ÙˆØ§Ù„Ø¥Ø¨Ø¯Ø§Ø¹", items: ["Ø§Ù„Ø±Ø³Ù… ÙˆØ§Ù„ØªØµÙ…ÙŠÙ…", "Ø§Ù„ØªØµÙˆÙŠØ±", "Ø§Ù„Ù…ÙˆØ³ÙŠÙ‚Ù‰", "Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ©", "Ø§Ù„Ø£ÙÙ„Ø§Ù… ÙˆØ§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª"] },
        { cat: "âš½ Ø§Ù„Ø±ÙŠØ§Ø¶Ø© ÙˆØ§Ù„Ø£Ù†Ø´Ø·Ø©", items: ["ÙƒØ±Ø© Ø§Ù„Ù‚Ø¯Ù…", "ÙƒØ±Ø© Ø§Ù„Ø³Ù„Ø©", "Ø§Ù„Ø¬Ø±ÙŠ ÙˆØ§Ù„Ù„ÙŠØ§Ù‚Ø©", "Ø§Ù„Ø³Ø¨Ø§Ø­Ø©", "Ø§Ù„Ø±ÙŠØ§Ø¶Ø§Øª Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©"] },
        { cat: "ğŸŒ Ø§Ù„Ø³ÙØ± ÙˆØ§Ù„Ø§Ø³ØªÙƒØ´Ø§Ù", items: ["Ø§Ù„Ø³ÙØ± ÙˆØ§Ù„Ø³ÙŠØ§Ø­Ø©", "Ø§Ù„Ø·Ø¨ÙŠØ¹Ø©", "Ø§Ù„Ù…Ø¯Ù† ÙˆØ§Ù„Ù…Ø¹Ø§Ù„Ù…", "Ø§Ù„Ù…Ø£ÙƒÙˆÙ„Ø§Øª Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠØ©"] },
        { cat: "ğŸ’» Ø§Ù„ØªÙ‚Ù†ÙŠØ© ÙˆØ§Ù„Ø±Ù‚Ù…ÙŠØ©", items: ["Ø§Ù„Ø¨Ø±Ù…Ø¬Ø©", "Ø§Ù„Ø£Ù„Ø¹Ø§Ø¨", "Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ", "Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ø°ÙƒÙŠØ©"] },
        { cat: "â¤ï¸ Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª Ø´Ø®ØµÙŠØ©", items: ["Ø§Ù„Ø·Ø¨Ø®", "Ø§Ù„Ù…ÙˆØ¶Ø©", "Ø§Ù„ØµØ­Ø© ÙˆØ§Ù„Ø¹Ø§ÙÙŠØ©", "Ø§Ù„Ø­ÙŠÙˆØ§Ù†Ø§Øª", "Ø§Ù„Ø¹Ù…Ù„ Ø§Ù„ØªØ·ÙˆØ¹ÙŠ"] }
    ];

    // Ø¨Ù†Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª
    const container = document.getElementById("interestsList");
    interestsData.forEach(group => {
        container.innerHTML += `<div class="int-group-title">${group.cat}</div>`;
        group.items.forEach(item => {
            container.innerHTML += `
                <div class="int-item">
                    <input type="checkbox" class="int-check" value="${item}">
                    <span>${item}</span>
                </div>`;
        });
    });

    onAuthStateChanged(auth, async (user) => {
        if(user) {
            const snap = await getDoc(doc(db, "users", user.uid));
            if(snap.exists()) {
                const data = snap.data();
                document.getElementById("uName").value = data.fullname || "";
                document.getElementById("uCountry").value = data.country || "";
                document.getElementById("uPoints").innerText = data.points || 0;
                
                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø³Ø¨Ù‚Ø§Ù‹
                if(data.interests) {
                    const checks = document.querySelectorAll('.int-check');
                    checks.forEach(ch => { if(data.interests.includes(ch.value)) ch.checked = true; });
                }
            }
        } else { window.location.href = "login.html"; }
    });

    window.saveProfile = async () => {
        const selected = Array.from(document.querySelectorAll('.int-check:checked')).map(el => el.value);
        try {
            await updateDoc(doc(db, "users", auth.currentUser.uid), {
                fullname: document.getElementById("uName").value,
                country: document.getElementById("uCountry").value,
                interests: selected
            });
            alert("ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§ØªÙƒ Ø¨Ù†Ø¬Ø§Ø­! âœ¨");
        } catch (e) { alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ÙØ¸!"); }
    };

    // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ù…Ø¸Ù‡Ø±
    if(localStorage.getItem("theme") === "dark") document.documentElement.setAttribute("data-theme", "dark");
</script>
</body>
</html>