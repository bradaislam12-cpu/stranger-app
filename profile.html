here<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title class="tr" data-key="profile_header">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ | SM</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .profile-card { text-align: center; position: relative; }
    .avatar-wrapper { position: relative; width: 120px; height: 120px; margin: 0 auto 20px; }
    .avatar-wrapper img { 
      width: 100%; height: 100%; border-radius: 50%; 
      object-fit: cover; border: 4px solid var(--p); 
    }
    .edit-icon {
      position: absolute; bottom: 0; right: 0; background: var(--p);
      color: white; border-radius: 50%; padding: 8px; cursor: pointer;
    }
    .interests-grid {
      display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
      gap: 10px; text-align: right; margin: 15px 0;
    }
    .interest-item {
      display: flex; align-items: center; gap: 5px; font-size: 0.85rem;
    }
    .danger-zone {
      margin-top: 30px; padding-top: 20px; border-top: 1px dashed #ddd;
    }
  </style>
</head>
<body class="light-mode">

  <div class="header">
    <button class="icon-btn" onclick="location.href='dashboard.html'">ğŸ”™</button>
    <h2 class="tr" data-key="profile_header">Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠ</h2>
    <div style="display:flex; gap:8px;">
      <button id="themeBtn" class="icon-btn">ğŸŒ“</button>
      <button id="langBtn" class="friend-btn">EN</button>
    </div>
  </div>

  <div class="profile-form">
    <div class="profile-card">
      <div class="avatar-wrapper">
        <img id="profilePreview" src="default-avatar.png">
        <label for="avatarInput" class="edit-icon">ğŸ“·</label>
        <input type="file" id="avatarInput" hidden accept="image/*">
      </div>
      
      <form id="profileUpdateForm">
        <label class="tr" data-key="fullname_placeholder">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
        <input type="text" id="pFullname" required>

        <label class="tr" data-key="gender_label">Ø§Ù„Ø¬Ù†Ø³</label>
        <select id="pGender">
          <option value="male" class="tr" data-key="male">Ø°ÙƒØ±</option>
          <option value="female" class="tr" data-key="female">Ø£Ù†Ø«Ù‰</option>
        </select>

        <label class="tr" data-key="seeking_label">Ø£Ù‡ØªÙ… Ø¨Ù…Ù‚Ø§Ø¨Ù„Ø©</label>
        <select id="pSeeking">
          <option value="male" class="tr" data-key="seeking_male">Ø±Ø¬Ø§Ù„</option>
          <option value="female" class="tr" data-key="seeking_female">Ù†Ø³Ø§Ø¡</option>
          <option value="both" class="tr" data-key="seeking_both">Ø§Ù„Ø¬Ù…ÙŠØ¹</option>
        </select>

        <label class="tr" data-key="interests_label">Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª</label>
        <div class="interests-grid" id="pInterests">
          </div>

        <button type="submit" id="saveBtn" class="start-btn tr" data-key="save_changes">Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª âœ…</button>
      </form>

      <div class="danger-zone">
        <button id="deleteAccBtn" class="icon-btn" style="color:var(--danger); font-size: 0.9rem;">
          âš ï¸ <span class="tr" data-key="delete_account">Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹</span>
        </button>
      </div>
    </div>
    <div id="pStatus" style="margin-top:15px; text-align:center; font-weight:bold;"></div>
  </div>

  <script type="module">
    import { auth, db, doc, getDoc, updateDoc, deleteAccount, toggleLang, toggleTheme, applyTranslations, initUI } from './ui-logic.js';

    const interestsList = ["Sports", "Gaming", "Tech", "Music", "Art", "Travel", "Cooking", "Coding"];
    
    // ØªÙ‡ÙŠØ¦Ø© ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    initUI();
    document.getElementById('themeBtn').onclick = toggleTheme;
    document.getElementById('langBtn').onclick = toggleLang;

    // Ù…Ù„Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª
    const grid = document.getElementById('pInterests');
    interestsList.forEach(item => {
      const div = document.createElement('div');
      div.className = 'interest-item';
      div.innerHTML = `<input type="checkbox" value="${item}"> <span>${item}</span>`;
      grid.appendChild(div);
    });

    // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    auth.onAuthStateChanged(async (user) => {
      if (!user) {
        window.location.replace("login.html");
        return;
      }

      const snap = await getDoc(doc(db, "users", user.uid));
      if (snap.exists()) {
        const data = snap.data();
        document.getElementById('pFullname').value = data.fullname || "";
        document.getElementById('pGender').value = data.gender || "male";
        document.getElementById('pSeeking').value = data.seeking || "both";
        document.getElementById('profilePreview').src = data.avatarUrl || "default-avatar.png";
        
        // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
        const checks = document.querySelectorAll('#pInterests input');
        checks.forEach(ch => {
          if (data.interests && data.interests.includes(ch.value)) ch.checked = true;
        });
      }
    });

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    document.getElementById('profileUpdateForm').onsubmit = async (e) => {
      e.preventDefault();
      const btn = document.getElementById('saveBtn');
      const status = document.getElementById('pStatus');
      const selectedInterests = Array.from(document.querySelectorAll('#pInterests input:checked')).map(c => c.value);

      try {
        btn.disabled = true;
        await updateDoc(doc(db, "users", auth.currentUser.uid), {
          fullname: document.getElementById('pFullname').value.trim(),
          gender: document.getElementById('pGender').value,
          seeking: document.getElementById('pSeeking').value,
          interests: selectedInterests
        });
        status.style.color = "green";
        status.innerText = "ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­! âœ¨";
        setTimeout(() => { status.innerText = ""; btn.disabled = false; }, 2000);
      } catch (err) {
        status.style.color = "var(--danger)";
        status.innerText = "ÙØ´Ù„ Ø§Ù„ØªØ­Ø¯ÙŠØ«ØŒ Ø­Ø§ÙˆÙ„ Ø«Ø§Ù†ÙŠØ©";
        btn.disabled = false;
      }
    };

    // Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨
    document.getElementById('deleteAccBtn').onclick = deleteAccount;

    // Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©
    document.getElementById('avatarInput').onchange = (e) => {
      const file = e.target.files[0];
      if (file) document.getElementById('profilePreview').src = URL.createObjectURL(file);
    };
  </script>
</body>
</html>
