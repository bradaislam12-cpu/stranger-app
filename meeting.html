<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>جاري الاتصال المرئي... | SM</title>
    <style>
        body { 
            background: #000; 
            color: #fff; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            height: 100vh; 
            margin: 0; 
            font-family: sans-serif; 
        }
        .loader { 
            border: 4px solid #333; 
            border-top: 4px solid #00a884; 
            border-radius: 50%; 
            width: 50px; 
            height: 50px; 
            animation: spin 1s linear infinite; 
            margin-bottom: 20px; 
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        h2 { font-weight: 300; letter-spacing: 1px; }
    </style>
</head>
<body>

    <div class="loader"></div>
    <h2 id="statusText">جاري تهيئة الغرفة الآمنة...</h2>

    <script>
        // 1. استخراج معرف الغرفة من الرابط
        const urlParams = new URLSearchParams(window.location.search);
        let roomID = urlParams.get('room') || "GlobalMeeting";
        
        // 2. تنظيف المعرف لضمان التوافق مع Jitsi
        const cleanRoom = "SM" + roomID.replace(/[^a-zA-Z0-9]/g, "");

        // 3. توليد اسم مستعار عشوائي سريع
        const nick = "User_" + Math.floor(Math.random() * 999);

        /* 4. بناء الرابط "الذكي":
           - disableDeepLinking=true: يمنع فتح تطبيق المتجر في الهواتف ويجبره على المتصفح.
           - prejoinPageEnabled=false: يتخطى شاشة "Join Meeting" السوداء.
           - disableLobby=true: يمنع "غرفة الانتظار" ليدخل الطرفان فوراً.
           - startWithAudioMuted/VideoMuted=false: لفتح المايك والكاميرا تلقائياً.
        */
        const jitsiUrl = `https://meet.jit.si/${cleanRoom}#userInfo.displayName="${nick}"&config.prejoinPageEnabled=false&config.disableDeepLinking=true&config.disableLobby=true&config.startWithAudioMuted=false&config.startWithVideoMuted=false`;

        // 5. التحويل التلقائي بعد ثانية واحدة لمنح المتصفح وقت للتهيئة
        setTimeout(() => {
            document.getElementById("statusText").innerText = "جاري فتح الكاميرا...";
            window.location.href = jitsiUrl;
        }, 1000);
    </script>
</body>
</html>
