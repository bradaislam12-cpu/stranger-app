<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title class="tr" data-key="login_title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ | Stranger Meeting</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .auth-container {
      display: flex; align-items: center; justify-content: center;
      min-height: calc(100vh - 80px); padding: 20px;
    }
    .google-btn {
      background: #ffffff; color: #757575; border: 1px solid #ddd;
      display: flex; align-items: center; justify-content: center; gap: 10px;
      margin-top: 10px; font-weight: bold; width: 100%; transition: 0.3s;
    }
    .google-btn:hover { background: #f8f8f8; }
    .google-btn img { width: 20px; }
    
    /* ØªØ­Ø³ÙŠÙ† Ø´ÙƒÙ„ Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª */
    input { width: 100%; margin-bottom: 15px; }
    label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 0.9rem; }
  </style>
</head>
<body class="light-mode">

  <div class="header">
    <button class="icon-btn" onclick="location.href='index.html'">ğŸ”™</button>
    <h2 class="tr" data-key="login_title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
    <div style="display:flex; gap:8px;">
      <button id="themeBtn" class="icon-btn">ğŸŒ“</button>
      <button id="langBtn" class="friend-btn">EN</button>
    </div>
  </div>

  <div class="auth-container">
    <div class="auth-box">
      <h2 class="tr" data-key="welcome_back" style="text-align: center; margin-bottom: 20px;">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ Ù…Ø¬Ø¯Ø¯Ø§Ù‹!</h2>
      
      <form id="loginForm">
        <label class="tr" data-key="email_label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
        <input type="email" id="email" required placeholder="example@mail.com" autocomplete="email">

        <label class="tr" data-key="pass_label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
        <input type="password" id="password" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" autocomplete="current-password">

        <button type="submit" id="loginBtn" class="start-btn tr" data-key="login" style="width: 100%; border: none;">
            ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        </button>
      </form>

      <div style="text-align: center; margin: 15px 0; opacity: 0.6; font-size: 0.8rem;">Ø£Ùˆ Ø¹Ø¨Ø± Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ</div>

      <button id="googleLoginBtn" class="start-btn google-btn">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
        <span class="tr" data-key="google_login">Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨ÙˆØ§Ø³Ø·Ø© Ø¬ÙˆØ¬Ù„</span>
      </button>

      <p style="text-align: center; margin-top: 25px; font-size: 0.9rem;">
        <span class="tr" data-key="no_account">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ</span> 
        <a href="register.html" style="color: var(--p); text-decoration: none; font-weight: bold;">Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù†</a>
      </p>
      
      <div id="statusMsg" style="margin-top: 15px; text-align: center; font-weight: bold; font-size: 0.85rem; min-height: 1.2rem;"></div>
    </div>
  </div>

  <script type="module">
    import { auth, loginWithGoogle, toggleLang, toggleTheme, applyTranslations, initUI } from './ui-logic.js';
    import { signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    // 1. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    window.addEventListener('DOMContentLoaded', initUI);
    document.getElementById('themeBtn').onclick = toggleTheme;
    document.getElementById('langBtn').onclick = toggleLang;

    const loginForm = document.getElementById('loginForm');
    const statusMsg = document.getElementById('statusMsg');

    // 2. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠ (ØªÙ… Ø­Ø°Ù Ø§Ù„ÙƒØ§Ø¨ØªØ´Ø§)
    loginForm.onsubmit = async (e) => {
      e.preventDefault();
      const lang = localStorage.getItem('preferredLang') || 'ar';
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;

      try {
        statusMsg.style.color = "var(--p)";
        statusMsg.innerText = lang === 'ar' ? "â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù‚Ù‚..." : "â³ Verifying...";
        
        await signInWithEmailAndPassword(auth, email, password);
        
        // Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¨Ø¹Ø¯ Ø§Ù„Ù†Ø¬Ø§Ø­
        window.location.replace("dashboard.html");
      } catch (error) {
        statusMsg.style.color = "var(--danger)";
        
        // Ø±Ø³Ø§Ø¦Ù„ Ø®Ø·Ø£ Ø£ÙˆØ¶Ø­ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
        if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential') {
            statusMsg.innerText = lang === 'ar' ? "âŒ Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©" : "âŒ Invalid email or password";
        } else {
            statusMsg.innerText = lang === 'ar' ? "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„" : "âŒ Login error occurred";
        }
        console.error("Login Error:", error.code);
      }
    };

    // 3. Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¬ÙˆØ¬Ù„
    document.getElementById('googleLoginBtn').onclick = async () => {
        try {
            await loginWithGoogle();
        } catch (error) {
            statusMsg.style.color = "var(--danger)";
            statusMsg.innerText = "âŒ ÙØ´Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¹Ø¨Ø± Ø¬ÙˆØ¬Ù„";
        }
    };

  </script>
</body>
</html>

