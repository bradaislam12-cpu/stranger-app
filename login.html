<!DOCTYPE html>
<html lang="ar" dir="rtl" id="mainHtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ğŸ”‘ | Stranger Meeting</title>
    <style>
        :root { --bg: #f0f2f5; --card: #fff; --text: #333; --input-bg: #fff; --accent: #4CAF50; }
        [data-theme="dark"] { --bg: #121212; --card: #1e1e1e; --text: #eee; --input-bg: #2a2a2a; --accent: #00a884; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); color: var(--text); display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; transition: 0.3s; }
        .card { background: var(--card); padding: 40px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 340px; text-align: center; }
        h2 { margin-bottom: 25px; color: var(--accent); }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 10px; background: var(--input-bg); color: var(--text); box-sizing: border-box; outline: none; }
        .btn { width: 100%; padding: 12px; background: var(--accent); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        .google-btn { background: white; color: #555; border: 1px solid #ddd; display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 15px; }
        .links { margin-top: 20px; font-size: 14px; }
        .links a { color: var(--accent); text-decoration: none; font-weight: bold; }
        .settings-btns { position: fixed; top: 20px; right: 20px; display: flex; gap: 10px; }
    </style>
</head>
<body>

<div class="settings-btns">
    <button class="btn" id="themeBtn" onclick="toggleTheme()" style="padding: 5px 10px;">ğŸŒ™</button>
    <button class="btn" id="langBtn" onclick="toggleLang()" style="padding: 5px 10px;">English ğŸŒ</button>
</div>

<div class="card">
    <h2 id="loginTitle">Ø¯Ø®ÙˆÙ„ Ø§Ù„ØºØ±Ø¨Ø§Ø¡ ğŸ”‘</h2>
    <input type="email" id="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ğŸ“§">
    <input type="password" id="pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ğŸ”’">
    <button class="btn" id="loginBtn" onclick="login()">Ø¯Ø®ÙˆÙ„ âœ…</button>
    
    <button class="btn google-btn" onclick="loginWithGoogle()">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/action/google.svg" width="18">
        <span id="googleText">Ù…ØªØ§Ø¨Ø¹Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¬ÙˆØ¬Ù„</span>
    </button>

    <div class="links">
        <span id="noAcc">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ</span> <a href="./register.html" id="regLink">Ø³Ø¬Ù„ Ù‡Ù†Ø§ âœ¨</a>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, signInWithPopup, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = { 
        apiKey: "AIzaSyAMA4owgSvA_sBh2syHOnRTS5fhnW1JIeg", 
        authDomain: "strangermeeting-91226.firebaseapp.com", 
        projectId: "strangermeeting-91226", 
        storageBucket: "strangermeeting-91226.firebasestorage.app", 
        messagingSenderId: "575547116212", 
        appId: "1:575547116212:web:333a4732abf59903e7e5e1" 
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    window.login = async () => {
        const e = document.getElementById("email").value;
        const p = document.getElementById("pass").value;
        try {
            await signInWithEmailAndPassword(auth, e, p);
            window.location.href = "./dashboard.html";
        } catch (err) { alert("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©"); }
    };

    window.loginWithGoogle = async () => {
        const provider = new GoogleAuthProvider();
        try {
            const res = await signInWithPopup(auth, provider);
            const user = res.user;
            const docRef = doc(db, "users", user.uid);
            const snap = await getDoc(docRef);
            if (!snap.exists()) {
                await setDoc(docRef, { fullname: user.displayName, email: user.email, points: 50, online: true });
            }
            window.location.href = "./dashboard.html";
        } catch (err) { alert("ÙØ´Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¬ÙˆØ¬Ù„"); }
    };

    // Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¨ÙŠÙ† Ø§Ù„Ù„ØºØ§Øª ÙˆØ§Ù„Ø³Ù…Ø§Øª
    window.toggleTheme = () => {
        let theme = localStorage.getItem("theme") === 'dark' ? 'light' : 'dark';
        localStorage.setItem("theme", theme);
        location.reload();
    };

    window.toggleLang = () => {
        let lang = localStorage.getItem("lang") === 'en' ? 'ar' : 'en';
        localStorage.setItem("lang", lang);
        location.reload();
    };

    function applySettings() {
        const theme = localStorage.getItem("theme") || "light";
        const lang = localStorage.getItem("lang") || "ar";
        document.documentElement.setAttribute("data-theme", theme);
        if(lang === 'en') {
            document.getElementById("mainHtml").dir = 'ltr';
            document.getElementById("loginTitle").innerText = "Stranger Login ğŸ”‘";
            document.getElementById("loginBtn").innerText = "Login âœ…";
        }
    }
    applySettings();
</script>
</body>
</html>