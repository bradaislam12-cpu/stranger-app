here<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title class="tr" data-key="login_title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ | Stranger Meeting</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .auth-container {
      display: flex; align-items: center; justify-content: center;
      min-height: calc(100vh - var(--header-h)); padding: 20px;
    }
    .captcha-box {
      background: var(--bg); padding: 15px; border-radius: 10px;
      margin-bottom: 15px; text-align: center; border: 1px dashed var(--p);
    }
    .google-btn {
      background: #ffffff; color: #757575; border: 1px solid #ddd;
      display: flex; align-items: center; justify-content: center; gap: 10px;
      margin-top: 10px; font-weight: bold;
    }
    .google-btn img { width: 20px; }
  </style>
</head>
<body class="light-mode">

  <div class="header">
    <button class="icon-btn" onclick="location.href='index.html'">ğŸ”™</button>
    <h2 class="tr" data-key="login_title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
    <div style="display:flex; gap:8px;">
      <button id="themeBtn" class="icon-btn">ğŸŒ“</button>
      <button id="langBtn" class="friend-btn">EN</button>
    </div>
  </div>

  <div class="auth-container">
    <div class="auth-box">
      <h2 class="tr" data-key="welcome_back">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ Ù…Ø¬Ø¯Ø¯Ø§Ù‹!</h2>
      
      <form id="loginForm">
        <label class="tr" data-key="email_label">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
        <input type="email" id="email" required placeholder="example@mail.com">

        <label class="tr" data-key="pass_label">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
        <input type="password" id="password" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">

        <div class="captcha-box">
          <span id="captchaQuestion">...</span>
          <input type="number" id="captchaAnswer" required placeholder="Ø§Ù„Ù†Ø§ØªØ¬" style="width: 80px; margin: 5px 0 0; text-align: center;">
        </div>

        <button type="submit" id="loginBtn" class="start-btn tr" data-key="login">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
      </form>

      <div style="text-align: center; margin: 15px 0; opacity: 0.6;">Ø£Ùˆ</div>

      <button id="googleLoginBtn" class="start-btn google-btn">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
        <span class="tr" data-key="google_login">Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨ÙˆØ§Ø³Ø·Ø© Ø¬ÙˆØ¬Ù„</span>
      </button>

      <p style="text-align: center; margin-top: 20px; font-size: 0.9rem;">
        <a href="register.html" class="tr" data-key="no_account" style="color: var(--p); text-decoration: none;">Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ Ø³Ø¬Ù„ Ø§Ù„Ø¢Ù†</a>
      </p>
      
      <div id="statusMsg" style="margin-top: 15px; text-align: center; font-weight: bold; font-size: 0.85rem;"></div>
    </div>
  </div>

  <script type="module">
    import { auth, loginWithGoogle, toggleLang, toggleTheme, applyTranslations, initUI } from './ui-logic.js';
    import { signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    // 1. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ÙƒØ§Ø¨ØªØ´Ø§
    let captchaResult;
    function generateCaptcha() {
      const lang = localStorage.getItem('preferredLang') || 'ar';
      const a = Math.floor(Math.random() * 10) + 1;
      const b = Math.floor(Math.random() * 10) + 1;
      captchaResult = a + b;
      document.getElementById('captchaQuestion').innerText = lang === 'ar' 
        ? `Ø£Ù…Ø§Ù†: ÙƒÙ… Ù†Ø§ØªØ¬ ${a} + ${b} ØŸ` 
        : `Security: What is ${a} + ${b}?`;
    }

    // 2. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    window.addEventListener('DOMContentLoaded', () => {
      initUI();
      generateCaptcha();
    });

    document.getElementById('themeBtn').onclick = toggleTheme;
    document.getElementById('langBtn').onclick = () => {
      toggleLang();
      generateCaptcha(); // ØªØ­Ø¯ÙŠØ« Ù„ØºØ© Ø§Ù„ÙƒØ§Ø¨ØªØ´Ø§ ÙÙˆØ±Ø§Ù‹
    };

    // 3. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ØªÙ‚Ù„ÙŠØ¯ÙŠ
    const loginForm = document.getElementById('loginForm');
    const statusMsg = document.getElementById('statusMsg');

    loginForm.onsubmit = async (e) => {
      e.preventDefault();
      const lang = localStorage.getItem('preferredLang') || 'ar';
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value;
      const captchaInput = document.getElementById('captchaAnswer').value;

      if (parseInt(captchaInput) !== captchaResult) {
        statusMsg.style.color = "var(--danger)";
        statusMsg.innerText = lang === 'ar' ? "âŒ Ø­Ù„ Ø§Ù„ÙƒØ§Ø¨ØªØ´Ø§ ØºÙŠØ± ØµØ­ÙŠØ­" : "âŒ Invalid CAPTCHA";
        generateCaptcha();
        return;
      }

      try {
        statusMsg.style.color = "var(--p)";
        statusMsg.innerText = lang === 'ar' ? "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¯Ø®ÙˆÙ„..." : "Logging in...";
        await signInWithEmailAndPassword(auth, email, password);
        window.location.replace("dashboard.html");
      } catch (error) {
        statusMsg.style.color = "var(--danger)";
        statusMsg.innerText = lang === 'ar' ? "âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª" : "âŒ Login failed";
        generateCaptcha();
      }
    };

    // 4. Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¬ÙˆØ¬Ù„
    document.getElementById('googleLoginBtn').onclick = loginWithGoogle;

  </script>
</body>
</html>
