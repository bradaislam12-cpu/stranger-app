<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title class="tr" data-key="register">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨ | SM</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="light-mode">

    <div class="auth-box">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <h2 class="tr" data-key="register" style="margin: 0;">Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨</h2>
            <button onclick="toggleLang()" id="langBtn" style="width: 35px; height: 35px; border-radius: 50%; padding: 0; font-size: 0.7rem; background: var(--p); color: white;">EN</button>
        </div>
        
        <input type="text" id="fullname" class="tr" data-key="fullname" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„">
        <input type="email" id="email" class="tr" data-key="email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ">
        <input type="password" id="pass" class="tr" data-key="pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">

        <div style="text-align: right; margin-top: 10px;">
            <label class="tr" data-key="age" style="font-size: 0.8rem; font-weight: bold;">Ø§Ù„Ø¹Ù…Ø±</label>
            <input type="number" id="age" placeholder="20" min="12" max="99">
        </div>

        <div style="text-align: right; margin-top: 10px;">
            <label class="tr" data-key="country" style="font-size: 0.8rem; font-weight: bold;">Ø§Ù„Ø¯ÙˆÙ„Ø©</label>
            <select id="country" style="width: 100%; padding: 10px; border-radius: 10px; background: var(--card); color: var(--txt); border: 1px solid #ddd;">
                <option value="" class="tr" data-key="select">Ø§Ø®ØªØ±...</option>
                <option value="egypt" class="tr" data-key="egypt">Ù…ØµØ±</option>
                <option value="saudi" class="tr" data-key="saudi">Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</option>
                <option value="algeria" class="tr" data-key="algeria">Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±</option>
                <option value="Iraq" class="tr" data-key="Iraq">Ø§Ù„Ø¹Ø±Ø§Ù‚</option>
                <option value="palestine" class="tr" data-key="palestine">ÙÙ„Ø³Ø·ÙŠÙ†</option>
                <option value="jordan" class="tr" data-key="jordan">Ø§Ù„Ø£Ø±Ø¯Ù†</option>
                <option value="morocco" class="tr" data-key="morocco">Ø§Ù„Ù…ØºØ±Ø¨</option>
            </select>
        </div>

        <div style="text-align: right; margin-top: 10px;">
            <label class="tr" data-key="interests" style="font-size: 0.8rem; font-weight: bold;">Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</label>
            <select id="interest" style="width: 100%; padding: 10px; border-radius: 10px; background: var(--card); color: var(--txt); border: 1px solid #ddd;">
                <option value="" class="tr" data-key="select">Ø§Ø®ØªØ±...</option>
                <option value="tech" class="tr" data-key="tech">ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§</option>
                <option value="gaming" class="tr" data-key="gaming">Ø£Ù„Ø¹Ø§Ø¨</option>
                <option value="sports" class="tr" data-key="sports">Ø±ÙŠØ§Ø¶Ø©</option>
                <option value="coding" class="tr" data-key="coding">Ø¨Ø±Ù…Ø¬Ø©</option>
                <option value="music" class="tr" data-key="music">Ù…ÙˆØ³ÙŠÙ‚Ù‰</option>
            </select>
        </div>

        <button id="regBtn" class="tr" data-key="register" style="width: 100%; margin-top: 25px;">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨</button>
        
        <p style="margin-top: 15px; font-size: 0.9rem;">
            <span class="tr" data-key="haveAccount">Ù„Ø¯ÙŠÙƒ Ø­Ø³Ø§Ø¨ØŸ</span> 
            <a href="login.html" class="tr" data-key="login" style="color: var(--p); font-weight: bold;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</a>
        </p>

        <button onclick="toggleTheme()" class="icon-btn" style="margin-top: 10px;">ğŸŒ“</button>
    </div>

    <script src="ui-logic.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyAMA4owgSvA_sBh2syHOnRTS5fhnW1JIeg", 
            authDomain: "strangermeeting-91226.firebaseapp.com", 
            projectId: "strangermeeting-91226", 
            storageBucket: "strangermeeting-91226.firebasestorage.app", 
            messagingSenderId: "575547116212", 
            appId: "1:575547116212:web:333a4732abf59903e7e5e1" 
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        document.getElementById("regBtn").onclick = async () => {
            const name = document.getElementById("fullname").value.trim();
            const email = document.getElementById("email").value.trim();
            const pass = document.getElementById("pass").value;
            const age = document.getElementById("age").value;
            const country = document.getElementById("country").value;
            const interest = document.getElementById("interest").value;

            if(!name || !email || !pass || !age || !country || !interest) {
                alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø§Ù†Ø§Øª Ø¨Ù…Ø§ ÙÙŠ Ø°Ù„Ùƒ Ø§Ù„Ø¹Ù…Ø± ÙˆØ§Ù„Ø¯ÙˆÙ„Ø©");
                return;
            }

            const btn = document.getElementById("regBtn");
            btn.innerText = "...";
            btn.disabled = true;

            try {
                // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨
                const res = await createUserWithEmailAndPassword(auth, email, pass);
                
                // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Firestore (Ø¨Ù…Ø§ ÙÙŠ Ø°Ù„Ùƒ Ø§Ù„Ø¹Ù…Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯)
                await setDoc(doc(db, "users", res.user.uid), {
                    fullname: name,
                    email: email,
                    age: age,
                    country: country,
                    interest: interest,
                    uid: res.user.uid,
                    createdAt: new Date()
                });

                location.href = "dashboard.html";
            } catch (e) {
                alert("Ø®Ø·Ø£: " + e.message);
                btn.innerText = "Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨";
                btn.disabled = false;
            }
        };
    </script>
</body>
</html>
