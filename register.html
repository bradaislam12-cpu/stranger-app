<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุฅูุดุงุก ุญุณุงุจ | SM</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="light-mode">

    <div class="auth-box">
        <h2>ุญุณุงุจ ุฌุฏูุฏ</h2>
        <p style="font-size: 0.9rem; opacity: 0.8; margin-bottom: 20px;">ุงูุถู ุฅูููุง ูุงุจุฏุฃ ุงูุชูุงุตู ุจุฎุตูุตูุฉ</p>

        <div style="text-align: right; width: 100%;">
            <input type="text" id="fullname" placeholder="ุงูุงุณู ุงููุงูู" required>
            <input type="email" id="email" placeholder="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู" required>
            <input type="password" id="pass" placeholder="ูููุฉ ุงููุฑูุฑ (6 ุฑููุฒ ูุฃูุซุฑ)" required>
        </div>

        <div style="font-size: 0.75rem; margin: 15px 0; color: var(--txt); opacity: 0.7;">
            ุจุงูุชุณุฌููุ ุฃูุช ุชูุงูู ุนูู <a href="terms.html" style="color: var(--p);">ุดุฑูุท ุงูุฎุฏูุฉ</a>
        </div>

        <button id="regBtn" style="width: 100%;">ุฅูุดุงุก ุงูุญุณุงุจ ๐</button>
        
        <p style="margin-top: 20px;">
            ูุฏูู ุญุณุงุจ ุจุงููุนูุ <a href="login.html" style="color: var(--p); font-weight: bold;">ุณุฌู ุฏุฎููู</a>
        </p>

        <div class="settings-bar" style="margin-top: 20px; display: flex; gap: 15px; justify-content: center;">
            <button onclick="toggleTheme()" title="ุชุจุฏูู ุงููุถุน">๐</button>
            <button onclick="location.href='index.html'" style="background:none; color:var(--txt); font-size: 0.8rem;">ุงูุฑุฆูุณูุฉ</button>
        </div>
    </div>

    <script src="ui-logic.js"></script>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = { 
            apiKey: "AIzaSyAMA4owgSvA_sBh2syHOnRTS5fhnW1JIeg", 
            authDomain: "strangermeeting-91226.firebaseapp.com", 
            projectId: "strangermeeting-91226", 
            storageBucket: "strangermeeting-91226.firebasestorage.app", 
            messagingSenderId: "575547116212", 
            appId: "1:575547116212:web:333a4732abf59903e7e5e1" 
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const regBtn = document.getElementById("regBtn");

        regBtn.onclick = async () => {
            const name = document.getElementById("fullname").value.trim();
            const email = document.getElementById("email").value.trim();
            const pass = document.getElementById("pass").value;

            if(!name || !email || !pass) {
                alert("ูุฑุฌู ุฅููุงู ูุงูุฉ ุงูุญููู");
                return;
            }

            if(pass.length < 6) {
                alert("ูููุฉ ุงููุฑูุฑ ูุฌุจ ุฃู ุชููู 6 ุฃุญุฑู ุนูู ุงูุฃูู");
                return;
            }

            regBtn.innerText = "ุฌุงุฑู ุงูุฅูุดุงุก...";
            regBtn.disabled = true;

            try {
                // 1. ุฅูุดุงุก ุงูุญุณุงุจ ูู ูุธุงู Firebase Auth
                const res = await createUserWithEmailAndPassword(auth, email, pass);
                
                // 2. ุญูุธ ุจูุงูุงุช ุงููุณุชุฎุฏู ุงูุฅุถุงููุฉ ูู Firestore
                await setDoc(doc(db, "users", res.user.uid), {
                    fullname: name,
                    email: email,
                    uid: res.user.uid,
                    joinedAt: new Date()
                });

                // 3. ุงูุชูุฌูู ูููุญุฉ ุงูุชุญูู
                location.href = "dashboard.html";
            } catch (error) {
                regBtn.innerText = "ุฅูุดุงุก ุงูุญุณุงุจ ๐";
                regBtn.disabled = false;
                if(error.code === 'auth/email-already-in-use') {
                    alert("ูุฐุง ุงูุจุฑูุฏ ูุณุฌู ูุณุจูุงู!");
                } else {
                    alert("ุฎุทุฃ: " + error.message);
                }
            }
        };
    </script>
</body>
</html>
