here<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title class="tr" data-key="app_name">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… | SM</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .dashboard-container {
      max-width: 900px; margin: 20px auto; padding: 15px;
      display: grid; grid-template-columns: 1fr 2fr; gap: 20px;
    }
    .status-card {
      background: var(--card); padding: 20px; border-radius: 20px;
      text-align: center; box-shadow: var(--shadow); height: fit-content;
    }
    .user-avatar {
      width: 100px; height: 100px; border-radius: 50%;
      object-fit: cover; border: 3px solid var(--p); margin-bottom: 15px;
    }
    .main-actions {
      display: flex; flex-direction: column; gap: 15px;
    }
    .discovery-box {
      background: var(--p); color: white; padding: 40px 20px;
      border-radius: 25px; text-align: center; box-shadow: var(--shadow);
      transition: transform 0.3s;
    }
    .discovery-box:hover { transform: scale(1.02); }
    .stat-badge {
      display: inline-block; padding: 5px 12px; border-radius: 50px;
      background: #e8f5e9; color: #2e7d32; font-size: 0.85rem; margin-top: 5px;
    }
    @media (max-width: 768px) {
      .dashboard-container { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body class="light-mode">

  <div class="header">
    <h2 class="tr" data-key="app_name">Stranger Meeting</h2>
    <div style="display:flex; gap:8px;">
      <button id="themeBtn" class="icon-btn">ğŸŒ“</button>
      <button id="langBtn" class="friend-btn">EN</button>
    </div>
  </div>

  <div class="dashboard-container">
    <div class="status-card">
      <img id="userImg" src="default-avatar.png" class="user-avatar" alt="User">
      <h3 id="userName">...</h3>
      <div class="stat-badge">â— Ù…ØªØµÙ„ Ø§Ù„Ø¢Ù†</div>
      <div style="margin-top: 20px; display: flex; flex-direction: column; gap: 10px;">
        <button onclick="location.href='profile.html'" class="friend-btn" style="width:100%">âš™ï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù„Ù</button>
        <button id="logoutBtn" class="icon-btn" style="color:var(--danger); font-size: 0.9rem;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ â‹</button>
      </div>
    </div>

    <div class="main-actions">
      <div class="discovery-box">
        <h1 class="tr" data-key="secure_chat">Ø§Ø¨Ø¯Ø£ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø¢Ù…Ù†Ø©</h1>
        <p style="margin-bottom: 25px; opacity: 0.9;">Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£Ø´Ø®Ø§Øµ ÙŠØ´Ø§Ø±ÙƒÙˆÙ†Ùƒ Ù†ÙØ³ Ø§Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ø§Øª Ø­ÙˆÙ„ Ø§Ù„Ø¹Ø§Ù„Ù…</p>
        <button id="startSearchBtn" class="start-btn" style="background: white; color: var(--p); font-size: 1.2rem;">
          ğŸš€ Ø§Ø¨Ø­Ø« Ø¹Ù† Ø´Ø±ÙŠÙƒ Ù…ØªØ§Ø­
        </button>
      </div>

      <div class="status-card" style="text-align: right;">
        <h4 style="margin-bottom: 10px;">Ù†ØµÙŠØ­Ø© Ø§Ù„Ø£Ù…Ø§Ù† ğŸ›¡ï¸</h4>
        <p style="font-size: 0.85rem; opacity: 0.8;">Ù„Ø§ ØªØ´Ø§Ø±Ùƒ Ù…Ø¹Ù„ÙˆÙ…Ø§ØªÙƒ Ø§Ù„Ø¨Ù†ÙƒÙŠØ© Ø£Ùˆ ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ± Ù…Ø¹ Ø§Ù„ØºØ±Ø¨Ø§Ø¡. Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ù‡Ù†Ø§ Ù…Ø´ÙØ±Ø© ØªÙ…Ø§Ù…Ø§Ù‹.</p>
      </div>
    </div>
  </div>

  <script type="module">
    import { auth, db, doc, getDoc, updateDoc, startDiscovery, toggleLang, toggleTheme, applyTranslations } from './ui-logic.js';
    import { onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    // 1. Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙˆØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        window.location.replace("login.html");
      } else {
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù‚Ø¨ÙˆÙ„ Ø§Ù„Ø´Ø±ÙˆØ·
        if (localStorage.getItem('termsAccepted') !== 'true') {
          window.location.replace("terms.html");
          return;
        }

        const userDoc = await getDoc(doc(db, "users", user.uid));
        if (userDoc.exists()) {
          const data = userDoc.data();
          document.getElementById('userName').innerText = data.fullname || "Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯";
          if (data.avatarUrl) document.getElementById('userImg').src = data.avatarUrl;
          
          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø­Ø§Ù„Ø© Ù„ÙŠÙƒÙˆÙ† Ù…ØªØµÙ„Ø§Ù‹ ÙˆØºÙŠØ± Ù…Ø´ØºÙˆÙ„
          await updateDoc(doc(db, "users", user.uid), { isOnline: true, isBusy: false });
        }
      }
    });

    // 2. ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ØºØ±Ø¨Ø§Ø¡
    document.getElementById('startSearchBtn').onclick = function() {
      startDiscovery(this);
    };

    // 3. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
    document.getElementById('logoutBtn').onclick = async () => {
      if(auth.currentUser) {
        await updateDoc(doc(db, "users", auth.currentUser.uid), { isOnline: false });
      }
      await signOut(auth);
      window.location.replace("index.html");
    };

    // 4. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
    const currentLang = localStorage.getItem('preferredLang') || 'ar';
    applyTranslations(currentLang);
    document.getElementById('themeBtn').onclick = toggleTheme;
    document.getElementById('langBtn').onclick = toggleLang;

  </script>
</body>
</html>
